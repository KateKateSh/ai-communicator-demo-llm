import requests
import streamlit as st

HF_TOKEN = st.secrets["HF_TOKEN"]

def query_huggingface(event, model="HuggingFaceH4/zephyr-7b-beta"):
prompt = f"""
–í–Ω–∏–º–∞–Ω–∏–µ: —Ç–µ–±–µ –¥–∞–Ω–æ —Å–æ–±—ã—Ç–∏–µ, –∏ —Ç—ã –¥–æ–ª–∂–µ–Ω –≤—ã–¥–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–∏–∑–Ω–µ—Å-–¥–µ–π—Å—Ç–≤–∏—è–º –≤ –ª–æ–≥–∏—Å—Ç–∏–∫–µ –∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–µ.

–§–æ—Ä–º–∞—Ç:
üìå –ü—Ä–æ–≥–Ω–æ–∑: ...
‚úÖ –î–µ–π—Å—Ç–≤–∏—è:
- ...
- ...
üë• –†–æ–ª–∏:
- ...
üß† –ü–æ—á–µ–º—É:
...

–ü—Ä–∏–º–µ—Ä:

–°–æ–±—ã—Ç–∏–µ: "14 —Ñ–µ–≤—Ä–∞–ª—è, –î–µ–Ω—å –≤—Å–µ—Ö –≤–ª—é–±–ª—ë–Ω–Ω—ã—Ö, —Å–Ω–µ–≥ –≤ –ú–æ—Å–∫–≤–µ"

üìå –ü—Ä–æ–≥–Ω–æ–∑: –æ–∂–∏–¥–∞–µ—Ç—Å—è —Ä–æ—Å—Ç —Å–ø—Ä–æ—Å–∞ –Ω–∞ —Ü–≤–µ—Ç—ã, –ø–æ–¥–∞—Ä–∫–∏, –¥–æ—Å—Ç–∞–≤–∫—É –µ–¥—ã. –ò–∑-–∑–∞ —Å–Ω–µ–≥–æ–ø–∞–¥–∞ –≤–æ–∑–º–æ–∂–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏ –∫—É—Ä—å–µ—Ä–æ–≤.
‚úÖ –î–µ–π—Å—Ç–≤–∏—è:
- –£–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–ø–∞—Å—ã –ø–æ–¥–∞—Ä–∫–æ–≤ –∏ –≤–∏–Ω–∞
- –†–∞—Å—à–∏—Ä–∏—Ç—å –∑–æ–Ω—É –¥–æ—Å—Ç–∞–≤–∫–∏
- –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å push –¥–ª—è –≤–µ—á–µ—Ä–Ω–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–∏—Ç—Ä–∏–Ω—É ‚Äú—Ä–æ–º–∞–Ω—Ç–∏–∫–∞‚Äù

üë• –†–æ–ª–∏:
- –õ–æ–≥–∏—Å—Ç–∏–∫–∞
- –°–∫–ª–∞–¥
- –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥

üß† –ü–æ—á–µ–º—É:
–ü—Ä–∞–∑–¥–Ω–∏–∫ + —Å–Ω–µ–≥ = –ø–∏–∫–æ–≤—ã–π —Å–ø—Ä–æ—Å, –Ω—É–∂–Ω–æ –∏–∑–±–µ–∂–∞—Ç—å –∑–∞–¥–µ—Ä–∂–µ–∫.

---

–°–æ–±—ã—Ç–∏–µ: {event}

–û—Ç–≤–µ—Ç:
"""

    url = f"https://api-inference.huggingface.co/models/{model}"
    headers = {"Authorization": f"Bearer {HF_TOKEN}"}
    payload = {
        "inputs": prompt,
        "parameters": {
            "max_new_tokens": 300,
            "temperature": 0.7,
            "top_p": 0.9
        }
    }

    try:
        response = requests.post(url, headers=headers, json=payload, timeout=30)
        response.raise_for_status()
        result = response.json()
        if isinstance(result, list) and "generated_text" in result[0]:
            return result[0]["generated_text"].split("---")[-1].strip()
        return "[‚ö†Ô∏è –û—Ç–≤–µ—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç–∞]"
    except Exception as e:
        return f"[‚ùå –û—à–∏–±–∫–∞ LLM: {str(e)}]"
