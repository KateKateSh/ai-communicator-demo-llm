import requests
import streamlit as st

HF_TOKEN = st.secrets["HF_TOKEN"]

def query_huggingface(event, model="HuggingFaceH4/zephyr-7b-beta"):
    prompt = f"""
–¢—ã ‚Äî AI-–∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä —Å–ø—Ä–æ—Å–∞ –¥–ª—è –ª–æ–≥–∏—Å—Ç–∏–∫–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ –Ø–Ω–¥–µ–∫—Å. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è (–ø–æ–≥–æ–¥–∞, –ø—Ä–∞–∑–¥–Ω–∏–∫–∏, –∞–∫—Ü–∏–∏, –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è) –∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç —Å–Ω–∏–∑–∏—Ç—å —Ä–∏—Å–∫–∏ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã.

–¢—ã –¥–æ–ª–∂–µ–Ω:
1. –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∞—Ç–∫–∏–π –ø—Ä–æ–≥–Ω–æ–∑ (—á—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è –≤ —Å–ø—Ä–æ—Å–µ)
2. –í—ã–¥–∞—Ç—å 3‚Äì4 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –∫–æ–º–∞–Ω–¥
3. –ù–∞–∑–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö (—Ä–æ–ª–∏)
4. –û–±—ä—è—Å–Ω–∏—Ç—å, –ø–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ ‚Äî –∫—Ä–∞—Ç–∫–æ

üéØ –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:

üìå –ü—Ä–æ–≥–Ω–æ–∑: ...
‚úÖ –î–µ–π—Å—Ç–≤–∏—è:
- ...
- ...
- ...
üë• –†–æ–ª–∏:
- ...
üß† –ü–æ—á–µ–º—É:
...

–í–æ—Ç –ø—Ä–∏–º–µ—Ä:

–°–æ–±—ã—Ç–∏–µ: "14 —Ñ–µ–≤—Ä–∞–ª—è, –î–µ–Ω—å –≤—Å–µ—Ö –≤–ª—é–±–ª—ë–Ω–Ω—ã—Ö, —Å–Ω–µ–≥ –≤ –ú–æ—Å–∫–≤–µ"

üìå –ü—Ä–æ–≥–Ω–æ–∑: –æ–∂–∏–¥–∞–µ—Ç—Å—è —Ä–æ—Å—Ç —Å–ø—Ä–æ—Å–∞ –Ω–∞ —Ü–≤–µ—Ç—ã, –ø–æ–¥–∞—Ä–∫–∏, –¥–æ—Å—Ç–∞–≤–∫—É –µ–¥—ã. –ò–∑-–∑–∞ —Å–Ω–µ–≥–æ–ø–∞–¥–∞ –≤–æ–∑–º–æ–∂–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏ –∫—É—Ä—å–µ—Ä–æ–≤ –≤ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã—Ö —Ä–∞–π–æ–Ω–∞—Ö.

‚úÖ –î–µ–π—Å—Ç–≤–∏—è:
- –£–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–ø–∞—Å—ã —Ü–≤–µ—Ç–æ–≤, —à–æ–∫–æ–ª–∞–¥–∞ –∏ –≤–∏–Ω–∞ –≤ –õ–∞–≤–∫–µ –≤ —Ü–µ–Ω—Ç—Ä–µ –ú–æ—Å–∫–≤—ã
- –ü–æ–≤—ã—Å–∏—Ç—å –∑–æ–Ω—É –ø–æ–∫—Ä—ã—Ç–∏—è –∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –∫—É—Ä—å–µ—Ä–æ–≤ —Å 16:00 –¥–æ 22:00
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –≤–µ—á–µ—Ä–Ω–∏–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É –ø–æ–¥–∞—Ä–∫–æ–≤
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–∏—Ç—Ä–∏–Ω—É ‚Äú—Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –Ω–∞–±–æ—Ä‚Äù –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

üë• –†–æ–ª–∏:
- –°–∫–ª–∞–¥
- –õ–æ–≥–∏—Å—Ç–∏–∫–∞
- –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥

üß† –ü–æ—á–µ–º—É:
–ü–æ–≤—ã—à–µ–Ω–Ω—ã–π –≤–µ—á–µ—Ä–Ω–∏–π —Å–ø—Ä–æ—Å + —Å–Ω–µ–≥ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–¥–æ–≤–æ–ª—å—Å—Ç–≤—É –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –ø–æ—Ç–µ—Ä–µ –∑–∞–∫–∞–∑–æ–≤. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞—Ä–∞–Ω–µ–µ –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏.

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ:

–°–æ–±—ã—Ç–∏–µ: {event}
"""

    url = f"https://api-inference.huggingface.co/models/{model}"
    headers = {"Authorization": f"Bearer {HF_TOKEN}"}
    payload = {
        "inputs": prompt,
        "parameters": {
            "max_new_tokens": 300,
            "temperature": 0.7,
            "top_p": 0.9
        }
    }

    try:
        response = requests.post(url, headers=headers, json=payload, timeout=30)
        response.raise_for_status()
        result = response.json()
        if isinstance(result, list) and "generated_text" in result[0]:
            return result[0]["generated_text"]
        return "[‚ö†Ô∏è –û—Ç–≤–µ—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç–∞]"
    except Exception as e:
        return f"[‚ùå –û—à–∏–±–∫–∞ LLM: {str(e)}]"
